# 株式暴騰暴落ニュース監視システム

Googleスプレッドシートで管理する保有銘柄（日本株）のニュースを自動収集し、**Gemini (AI)** を用いて「暴落（悪材料）」または「暴騰（好材料）」につながる重要ニュースのみを厳選して通知するシステムです。

## 主な機能

1.  **スプレッドシート連携**: 監視対象の銘柄リスト（約500銘柄）をGoogle Sheetsから直接読み込みます。
2.  **ハイブリッド・フィルタリング**:
    * **時刻フィルタ**: 重複通知を防ぐため、前回実行以降のニュースのみを厳密に抽出。
    * **キーワード一次選別**: 「赤字」「上方修正」などの単語でノイズ（PR記事等）を除去。
    * **AI二次選別 (Gemini 1.5 Flash)**: ニュースの内容が「投資判断に影響するか」をAIが判定。
3.  **メール通知 & 履歴自動削除**:
    * 「悪材料（警告）」と「好材料（福音）」を別件名で通知。
    * **プライバシー保護**: 送信元Gmailの「送信済みトレイ」から通知メールを自動削除し、メールボックスを汚しません。
4.  **完全自動化**: 1日2回（前場引け後・大引け後）自動でチェックを行います。

## 実行スケジュール (JST)

日本株の開示時刻に合わせて最適化されています。

| 実行時刻 | 対象となるニュース発表時間 | 狙い |
| :--- | :--- | :--- |
| **12:05** | 前日 17:00 〜 当日 12:04 | 夜間〜前場の速報（後場の初動狙い） |
| **17:00** | 当日 12:05 〜 当日 16:59 | 後場〜大引けの決算・開示（翌日の仕込み） |

## セットアップ手順

このリポジトリをForkまたはCloneして使用する場合の設定です。
**※機密情報はコードに一切記述せず、GitHub Secretsで管理します。**

### 1. 必要なAPI・アカウント
* **Google Cloud Platform**: Google Sheets API, Google Drive API の有効化とサービスアカウントキー(JSON)の発行。
* **Google AI Studio**: Gemini APIキーの発行。
* **Gmail**: 送信元となるアカウントでの「アプリパスワード」の発行。

### 2. Googleスプレッドシートの準備
* シート名: `任意`
* データ形式: A列2行目以降に銘柄コードを記載（例: `7203`, `9984.T` など）。
* **権限設定**: 手順1で作成したGCPサービスアカウントのメールアドレスを「閲覧者」として招待してください。

### 3. GitHub Secretsの設定
リポジトリの `Settings` > `Secrets and variables` > `Actions` に以下の変数を設定してください。

| Secret名 | 設定値の内容 |
| :--- | :--- |
| `GCP_SA_KEY` | GCPサービスアカウントのJSONキーの中身全て |
| `SPREADSHEET_ID` | 対象スプレッドシートのURLに含まれるID |
| `GEMINI_API_KEY` | Google Gemini APIキー |
| `GMAIL_USER` | 送信元のGmailアドレス |
| `GMAIL_APP_PASSWORD` | Gmailのアプリパスワード (16桁) |
| `EMAIL_TO` | 通知先のメールアドレス |

## ディレクトリ構成

```text
stock-news-monitor/
├── .github/workflows/
│   └── daily_check.yml  # GitHub Actions スケジュール設定 (UTC記述)
├── src/
│   ├── main.py          # エントリーポイント
│   ├── news_fetcher.py  # ニュース収集・時刻フィルタ・KWフィルタ
│   ├── ai_judge.py      # Gemini APIによる判定ロジック
│   ├── mail_handler.py  # メール送信 & 送信履歴削除処理
│   ├── sheet_loader.py  # スプレッドシート読み込み
│   └── config.py        # 環境変数読み込み
├── requirements.txt     # 依存ライブラリ
└── README.md            # ドキュメント
